# 南川核心研发笔记 | VR 系统原理与设计实现

## VR 概要

### VR 的定义

VR 的全称是`Virtual Reality`，即虚拟现实。

它的基本原理可以参考： [虚拟现实(VR)是什么原理？ - 知乎](https://zhuanlan.zhihu.com/p/30192848)

### VR 的优势

现在我们普通民众与计算机软硬件的主要交互窗口是 2d 的屏幕，大到投影仪、电视机、电脑屏幕，小到 iPad、手机、手表等。

得益于数学在 3d 渲染领域的应用技术，我们也很容易在一个 2d 可视区域内表达 3d 物体的形状、大小、远近、阴影等层次关系。

但这仅仅是能够让画面内的物体有层次感，离真正的人眼实感仍有差距，最典型的，难以感受到真实的距离感——当你注视一副 3d 画时，你能够知道画内不同的物体是有不同距离含义的，也就是你能捕捉到它们内部的相对关系，但它与你的眼睛无关。

VR 则能超越这一点，它可以让你感觉到非常逼真的距离感，比如一块石头从你眼前飞过，你会吓得本能性闪躲。

而这，正是 VR 技术吸引我们的地方：能让我们身临其境。

## 反畸变

### 反畸变原理

如下图所示，在默认情况下，正常画面`(a)`透过 vr 头显的光学镜头会变成`(b)`。而为了让 vr 在安卓设备上正常显示成矩形效果，需要做一次反畸变，将`(b)`重新变成`(a)`。

<img alt="picture 49" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/arpara-vr-logic-1645798620190-6fbb799596db9af1f17bb19f02f03949f2c7fc1565b366ae4e029a9be53e310b.png" />

实现方式可能是多种多样的。目前我们的策略是用一个新的 mesh（$(100+1)^2*2$个顶点的双桶网）替换了系统自带的 mesh（一个简单矩形）。

替换 mesh 后，原先矩形`(a)`的图片，将被渲染成`(c)`，即桶型畸变的效果。我们在实际开发中，由于条件限制或出于便利性等考虑，会使用`scrcpy`进行投屏分析，这时候由于图像没有经过眼镜的光学畸变，效果便是一个桶型。

而此时，如果我们戴上眼镜，由于光学畸变，这个桶型`(c)`便又重新显示回了矩形`(a)`。

### 反畸变实现

反畸变有很多种实现，但主要可分系统层实现与应用层实现。

简单说说系统层实现的方案。

## Timewarp

### timewarp 原理

技术上，反畸变与 timewarp 是独立的，并且实现原理不同。

## info

- author: 南川

### version: 0.0.2

- date: 2022-03-15
- content: TODO:

### version: 0.0.1

- date: 2022-02-25
- content: introduced vr principle
